# @package _global_
seed: 100
task_name: experiment_test

callbacks:
  model_checkpoint:
    every_n_epochs: 20
  image_logger:
    sampling_freq: 2297
    num_batches: 3
    sampling_batch_size: 3
    cond: true
    uncond: true
    cfg: true
  eval_callback:
    eval_freq: 4594
    eval_cmmd: true
    eval_fid: false
    eval_kid: false
    cond: true
    uncond: true
    cfg: true
    num_images: 100
    delete_samples: true
  test_callback:
    eval_cmmd: true
    eval_fid: true
    eval_kid: true
    cond: true
    uncond: true
    cfg: true

data:
  batch_size: 10
  gradient_accumulation: 1

  persistent_workers: false
  pin_memory: false
  num_workers: 2

  num_val: 50
  num_stable_train: 50

  train_dataset:
    transforms:
      _target_: torchvision.transforms.v2.Compose
      transforms:
        - _target_: torchvision.transforms.v2.ToTensor
        - _target_: torchvision.transforms.v2.Resize
          size: 512
          interpolation: 3
        - _target_: torchvision.transforms.v2.CenterCrop
          size: 512
        - _target_: torchvision.transforms.v2.RandomHorizontalFlip
          p: 0.5
        - _target_: dmt.data.dataset.DivideValue
          value: 127.5
        - _target_: dmt.data.dataset.AddValue
          value: -1.0
  val_dataset:
    transforms: ${data.train_dataset.transforms}
  test_dataset:
    transforms: ${data.train_dataset.transforms}

logger:
  wandb:
    project: dm-training

trainer:
  max_epochs: 40
  reload_dataloaders_every_n_epochs: 9999999
  val_check_interval: 0.25

model:
  model_name: stabilityai/stable-diffusion-2-1-base
  loss_type: mse
  prediction_type: epsilon
  zero_snr: false
  snr_gamma: null

  gradient_checkpointing: true

  region_masked_attn: false

  optimizer:
    lr: 2e-5

  scheduler:
    _target_: torch.optim.lr_scheduler.ConstantLR
    _partial_: true
    factor: 1.0
    total_iters: 999999999